CREATE OR REPLACE PROCEDURE SQHRS.HR_MDM_PSNDOC_PRC AS
BEGIN
 /*新增及修改人员信息*/
merge into  hr_mdm_psndoc_log a
using (select PK_PSNDOC,PSNCODE,PSNNAME,BXBH,EMAIL,ORGCODE,ORGNAME,DEPTCODE,DEPTNAME,FULLDEPTNAME,POSTNAME,PSNTYPE,PSNSTATE,SEX,OFFICEPHONE,MOBILE from hr_mdm_psndoc_view 
       minus
       select PK_PSNDOC,PSNCODE,PSNNAME,BXBH,EMAIL,ORGCODE,ORGNAME,DEPTCODE,DEPTNAME,FULLDEPTNAME,POSTNAME,PSNTYPE,PSNSTATE,SEX,OFFICEPHONE,MOBILE  from hr_mdm_psndoc_log) b
on (a.PK_PSNDOC=b.PK_PSNDOC)
when matched then update
     set a.PSNCODE=b.PSNCODE,a.PSNNAME=b.PSNNAME,a.BXBH=b.BXBH,a.EMAIL=b.EMAIL,a.ORGCODE=b.ORGCODE,a.ORGNAME=b.ORGNAME,
     a.DEPTCODE=b.DEPTCODE,a.DEPTNAME=b.DEPTNAME,a.FULLDEPTNAME=b.FULLDEPTNAME,a.POSTNAME=b.POSTNAME,a.PSNTYPE=b.PSNTYPE,
     a.PSNSTATE=b.PSNSTATE,a.SEX=b.SEX,a.OFFICEPHONE=b.OFFICEPHONE,a.MOBILE=b.MOBILE,
     a.flag='2' 
when not matched then insert values (b.PK_PSNDOC,b.PSNCODE,b.PSNNAME,b.BXBH,b.EMAIL,b.ORGCODE,b.ORGNAME,b.DEPTCODE,b.DEPTNAME,b.FULLDEPTNAME,b.POSTNAME,
b.PSNTYPE,b.PSNSTATE,'1',B.SEX,B.OFFICEPHONE,B.MOBILE);
commit;
update SQHRS.HR_MDM_PSNDOC_LOG t set flag = 1 where t.flag in ('8','9');
commit;
END HR_MDM_PSNDOC_PRC;